# 魚が描画されない問題の診断結果

## 問題の症状

- 画面には青い背景のみが表示され、魚が一切表示されない
- デバッグログによると、ほとんどのスプライトのサイズが `(0x0)` になっている
- 一部のスプライトは `size=(358x200)` で正常だが、多くが `size=(0x0)`

## ログ分析

### 観察された事実

1. **ログの開始位置**: ログは `setup()` 完了後から始まっている
   - 「Loaded fish image」メッセージが一切記録されていない
   - 画像読み込みの成功/失敗が不明

2. **スプライトサイズの不一致**:
   ```
   frame 0:
     Fish 0: ptr=0x4ff16c8c, size=(358x200)  ← 正常
     Fish 1: ptr=0x4ff1689c, size=(0x0)      ← サイズ0
     Fish 2: ptr=0x4ff16c8c, size=(358x200)  ← 正常
   ```

3. **パターン**: 右向きの魚（Fish 1, `facing_right=1`）のスプライトが常にサイズ0

## 根本原因の仮説

### 仮説1: メモリ不足

17枚の画像を一度に読み込むと、メモリが不足する可能性がある：
- 各スプライト: 358 × 200 × 2バイト = 143,200バイト
- 17枚合計: 約2.4MB
- ESP32-P4のPSRAMは十分あるはずだが、`createSprite()` が失敗している可能性

### 仮説2: 画像ファイルの問題

右向きの画像ファイルが破損しているか、正しく変換されていない可能性：
- 左向きスプライトは正常に読み込まれている
- 右向きスプライトの多くがサイズ0
- ファイルシステムの問題または画像変換の問題

### 仮説3: createSprite()の失敗

`createSprite()` が失敗すると、スプライトのサイズは0になる：
- メモリ割り当て失敗
- PSRAM初期化の問題
- M5Unifiedのバグ

## 次のステップ

1. **より詳細なデバッグログを追加**:
   - `createSprite()` の戻り値をチェック
   - `drawPng()` の戻り値をチェック
   - 各画像読み込み後のメモリ使用量を記録

2. **画像ファイルの確認**:
   - LittleFSにアップロードされた画像ファイルのサイズを確認
   - 右向き画像が正しく存在するか確認

3. **メモリ最適化**:
   - 画像を遅延読み込みに変更
   - 使用していないスプライトを解放
   - PSRAMの明示的な使用

4. **簡易テスト**:
   - 1枚の画像だけを読み込んでテスト
   - createSprite()が成功するか確認
